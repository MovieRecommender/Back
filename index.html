<!DOCTYPE html>
<html>

<head>
<link rel="stylesheet" type="text/css" href="main.css">
<script type="text/javascript" src="themoviedb.js"></script>
<script type="text/javascript" src="idtools.js"></script>
</head>

<body>

<h4 id="list"> </h4>


<div>
<h1 align="left" >SEARCH MOVIE</h1>
<form action="query.php" method="GET">
    <input type="text" placeholder="tag" name="tag" id="tag"><br />
    <input type="text" placeholder="people" name="people" id="people"><br />
    <input type="button" value="Click me" onclick="search()"><br />

</form>


<script>

var people = [];
var keywords = [];

var movies = [];

var peopleID = [];
var keywordsID = [];
var genresID = [];

function search(){

        empty(people);
        empty(peopleID);
        empty(keywords);
        empty(keywordsID);
        empty(genresID);
        empty(movies);

        var tag = document.getElementById("tag").value;
        var person = document.getElementById("people").value;

        if(person != ""){
                people.push(document.getElementById("people").value);
        }

        if(isGenre(tag) != null){
                genresID.push(isGenre(tag));
        }
        else if (tag != ""){
                keywords.push(tag);
        }

        main();
}

function main(){

        console.log(people);
        console.log(keywords);

        for(i = 0; i < people.length; i++){
                theMovieDb.search.getPerson({"query":escape(people[i])},getPeopleID, errorCB);
        }

        // gets ID # of all keywords
        for(i = 0; i < keywords.length; i++){
                // console.log("run");
                theMovieDb.search.getKeyword({"query":escape(keywords[i])},getKeywordID, errorCB);
        }

        //searches for movies with people & kewords tags
        console.log(peopleID);
        console.log(keywordsID);
        console.log(genresID);

        theMovieDb.discover.getMovies({"with_cast":peopleID.toString(),
                                                                                "with_keywords":keywordsID.toString(),
                                                                                "with_genres":genresID.toString(),
                                                                                }, discoverMovies, errorCB);
        // theMovieDb.discover.getMovies({"with_cast":287,"with_keywords":211721}, discoverMovies, errorCB);
        // theMovieDb.discover.getMovies({"with_cast":287}, discoverMovies, errorCB);
}

function discoverMovies(data){
        var arrayData = JSON.parse(data);
        // console.log(arrayData);
        console.log(arrayData["results"]);
        for(i = 0; i < arrayData["results"].length; i++){
                movies.push(arrayData["results"][i]["title"]);
        }
        console.log(movies);
        document.getElementById("list").innerHTML = movies;
}

</script>
</body>
    </div>
</html>
